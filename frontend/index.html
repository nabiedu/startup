<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Документ</title>
  </head>
  <body>
    <div class="container">
    <header>
      <div class="brand">
        <div class="logo">DW</div>
        <div>
          <div style="font-weight:700">DOKWORK.KZ</div>
          <div class="muted" style="font-size:13px">Помогаем мигрантам из Кыргызстана, Узбекистана и Таджикистана</div>
            <div class="muted">Горячая линия:</div>
            <div style="font-weight:700">+7 700 000 0000</div>
            <div class="muted">Email: hello@dokwork.kz</div>
          </div>
        </div>

        <aside>
          <div class="card">
            <h3 style="margin-top:0">Быстрый профиль</h3>
            <div class="muted" style="margin-bottom:10px">Заполните профиль — работодателям и хостелам будет проще связаться с вами.</div>
            <form id="quick-profile" onsubmit="event.preventDefault();saveProfile()">
              <label>Имя</label>
              <input type="text" id="q-name" placeholder="Ваше имя" required>
              <label>Страна</label>
              <select id="q-country"><option>Кыргызстан</option><option>Узбекистан</option><option>Таджикистан</option></select>
              <label>Телефон</label>
              <input type="text" id="q-phone" placeholder="+7 ...">
              <button class="btn btn-primary" type="submit">Сохранить профиль</button>
            </form>
            <div id="profile-saved" style="display:none;margin-top:8px;color:green">Профиль сохранён в локальном хранилище.</div>
          </div>
        </aside>
      </header>

      <main>

      <!-- Auth -->
      <section id="auth" style="margin-top:18px">
        <div class="card">
          <h3 style="margin-top:0">Аккаунт</h3>
          <div id="auth-forms">
            <form id="login-form" onsubmit="event.preventDefault();login()" style="margin-bottom:12px">
              <label>Email</label>
              <input type="email" id="a-email" required>
              <label>Пароль</label>
              <input type="password" id="a-password" required>
              <button class="btn btn-primary" type="submit">Войти</button>
            </form>

            <form id="register-form" onsubmit="event.preventDefault();register()">
              <label>Имя</label>
              <input type="text" id="r-name">
              <label>Email</label>
              <input type="email" id="r-email" required>
              <label>Пароль</label>
              <input type="password" id="r-password" required>
              <button class="btn btn-outline" type="submit">Регистрация</button>
            </form>
          </div>

          <div id="account-info" style="display:none">
            <div id="acc-welcome" style="font-weight:700"></div>
            <div style="margin-top:8px"><button class="btn btn-outline" onclick="logout()">Выйти</button></div>
            <div id="admin-panel" style="margin-top:12px;display:none">
              <h4>Admin: профили</h4>
                      <div id="admin-profiles" class="grid-3"></div>
                      <div style="margin-top:12px">
                        <h4>Управление объявлениями</h4>
                        <div id="admin-housing" class="grid-3"></div>
                        <div id="admin-jobs" class="grid-3"></div>
                      </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Documents -->
      <section id="documents" style="margin-top:12px">
        <div class="section-title">
          <h2>1) Оформление документов</h2>
          <div class="muted">Заполните заявку — мы подготовим чек-лист и помощь</div>
        </div>

        <div class="card" id="doc-form">
          <form onsubmit="event.preventDefault();submitDocumentRequest()">
            <label>Тип услуги</label>
            <select id="doc-type"><option>Оформление разрешения на временное проживание</option><option>Вид на жительство</option><option>Оформление ИИН</option><option>Медицинская страховка</option></select>
            <label>Имя и фамилия</label>
            <input type="text" id="doc-name" required>
            <label>Телефон</label>
            <input type="text" id="doc-phone" placeholder="+7 ..." required>
            <label>Email (опционально)</label>
            <input type="email" id="doc-email" placeholder="example@mail.com">
            <label>Комментарий</label>
            <textarea id="doc-comment" placeholder="Кратко опишите ситуацию"></textarea>
            <button class="btn btn-primary" type="submit">Отправить заявку</button>
            <div id="doc-msg" style="margin-top:8px;display:none"></div>
          </form>
        </div>
      </section>

      <!-- Housing -->
      <section id="housing" style="margin-top:18px">
        <div class="section-title">
          <h2>2) Объявления: хостелы и квартиры</h2>
          <div class="muted">Добавляйте объявления — снимайте надёжно и недорого</div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h3 style="margin-top:0">Добавить объявление</h3>
          <div style="margin-bottom:10px">
            <label>Поиск/фильтр</label>
            <input type="text" id="h-search" placeholder="Город, тип, минимальная цена" oninput="filterHousingClient()">
          </div>
          <form id="housing-form" onsubmit="event.preventDefault();addHousing()">
            <label>Тип</label>
            <select id="h-type"><option>Хостел</option><option>Комната</option><option>Квартира</option></select>
            <label>Город</label>
            <input type="text" id="h-city" placeholder="Алматы, Нур-Султан..." required>
            <label>Цена в месяц (KZT)</label>
            <input type="text" id="h-price" placeholder="25000">
            <label>Контакт</label>
            <input type="text" id="h-contact" placeholder="Телефон или telegram">
            <button class="btn btn-primary" type="submit">Добавить объявление</button>
          </form>
        </div>

  <div id="housing-list" class="grid-3" aria-live="polite"></div>
  <div id="housing-pager" style="margin-top:12px;display:flex;gap:8px;align-items:center"></div>
      </section>

      <!-- Jobs -->
      <section id="jobs" style="margin-top:18px">
        <div class="section-title">
          <h2>3) Поиск работы</h2>
          <div class="muted">Вакансии для мигрантов: стройка, сервис, логистика, производство</div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h3 style="margin-top:0">Опубликовать вакансию</h3>
          <div style="margin-bottom:10px">
            <label>Поиск вакансий</label>
            <input type="text" id="j-search" placeholder="Должность или город" oninput="filterJobsClient()">
          </div>
          <form id="job-form" onsubmit="event.preventDefault();addJob()">
            <label>Должность</label>
            <input type="text" id="j-title" required>
            <label>Город</label>
            <input type="text" id="j-city" required>
            <label>Заработная плата (KZT)</label>
            <input type="text" id="j-salary" placeholder="от 150000">
            <label>Контакт</label>
            <input type="text" id="j-contact" placeholder="Телефон или telegram">
            <button class="btn btn-primary" type="submit">Опубликовать вакансию</button>
          </form>
        </div>

  <div id="jobs-list" class="grid-3" aria-live="polite"></div>
  <div id="jobs-pager" style="margin-top:12px;display:flex;gap:8px;align-items:center"></div>
      </section>

    </main>

    <footer>
      © DOKWORK.KZ — 2025 · Сделано с заботой. <span class="muted">Связь: hello@dokwork.kz</span>
    </footer>
  </div>

  <script>
    // load DOMPurify from CDN (allowed in CSP)
    // if CDN blocked, DOMPurify fallback won't be available but server-side validation remains
  </script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js" integrity="sha256-+BQVf+g+g7xJ1q1D8l2eYkP9v+v+o1Q5QmQkqvT+7l4=" crossorigin="anonymous"></script>
  <script>
    // Backend base URL
    let API = 'http://localhost:4000'; // Default for local dev
    
    // Production URLs
    if (window.location.hostname === 'dokwork-frontend.netlify.app') {
      API = 'https://dokwork-api-production.railway.app';
    } else if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
      // For other deployments, try same origin
      API = `${window.location.protocol}//${window.location.hostname}:4000`;
    }

    // Generic helper: try POST to API, on failure save to offline queue
    async function postOrQueue(collection, payload){
      try{
        const res = await fetch(`${API}/${collection}`, {
          method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error('Network response not ok');
        return await res.json();
      }catch(err){
        // queue to localStorage
        const key = `dokwork_${collection}_offline`;
        const q = JSON.parse(localStorage.getItem(key)||'[]');
        q.unshift(payload);
        localStorage.setItem(key, JSON.stringify(q));
        return null;
      }
    }

    // Try to flush queues on start
    async function flushQueues(){
      const collections = ['housing','jobs','docs','profiles'];
      for(const col of collections){
        const key = `dokwork_${col}_offline`;
        const q = JSON.parse(localStorage.getItem(key)||'[]');
        if(q.length===0) continue;
        for(const item of [...q]){
          try{
            const res = await fetch(`${API}/${col}`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(item)});
            if(res.ok){
              // remove last queued (we iterate copy to avoid mutation issues)
              const existing = JSON.parse(localStorage.getItem(key)||'[]');
              existing.pop();
              localStorage.setItem(key, JSON.stringify(existing));
            }
          }catch(e){
            // stop trying this collection if network fails
            break;
          }
        }
      }
    }

    // Profiles
    async function saveProfile(){
      const p = {name:document.getElementById('q-name').value,country:document.getElementById('q-country').value,phone:document.getElementById('q-phone').value,time:new Date().toISOString()};
      const res = await postOrQueue('profiles', p);
      document.getElementById('profile-saved').style.display='block';
      document.getElementById('profile-saved').textContent = res ? 'Профиль сохранён на сервере.' : 'Профиль сохранён локально (офлайн).';
      setTimeout(()=>document.getElementById('profile-saved').style.display='none',2500);
    }

    // Documents
    async function submitDocumentRequest(){
      // sanitize inputs with DOMPurify when available
      const raw = { type:document.getElementById('doc-type').value, name:document.getElementById('doc-name').value, phone:document.getElementById('doc-phone').value, email:document.getElementById('doc-email').value, comment:document.getElementById('doc-comment').value };
      const data = Object.fromEntries(Object.entries(raw).map(([k,v])=>[k, (window.DOMPurify ? DOMPurify.sanitize(String(v)) : String(v))]));
      data.time = new Date().toISOString();
      const res = await postOrQueue('docs', data);
      const el = document.getElementById('doc-msg'); el.style.display='block'; el.style.color='green';
      el.textContent = res ? 'Заявка принята — мы свяжемся по телефону.' : 'Сервер недоступен — заявка сохранена локально.';
      setTimeout(()=>el.style.display='none',3000);
    }

    // Housing
    async function loadHousing(){
      const list = document.getElementById('housing-list'); list.innerHTML='';
      try{
        const res = await authFetch(`${API}/housing`);
        if(!res.ok) throw new Error('Bad response');
        const arr = await res.json();
        if(!arr || arr.items.length===0){ list.innerHTML='<div class="muted">Объявлений пока нет — вы можете добавить первое.</div>'; return }
        arr.items.forEach(h=>{
          const d=document.createElement('div');d.className='listing';
          d.innerHTML=`<div style=\"font-weight:700\">${h.type} — ${h.city}</div><div class=\"muted\">Цена: ${h.price||'по договорённости'}</div><div style=\"margin-top:6px\">${h.contact||''}</div>`;
          // edit/delete if owner or admin
          const token = getToken(); if(token){ const btns=document.createElement('div'); btns.style.marginTop='8px'; const edit=document.createElement('button'); edit.className='btn btn-outline'; edit.textContent='Редактировать'; edit.onclick=()=>editHousing(h); btns.appendChild(edit); const del=document.createElement('button'); del.className='btn btn-outline'; del.style.marginLeft='8px'; del.textContent='Удалить'; del.onclick=()=>deleteHousing(h.id); btns.appendChild(del); d.appendChild(btns);} 
          list.appendChild(d);
        });
      }catch(e){
        // fallback to localStorage
        const arr = JSON.parse(localStorage.getItem('dokwork_housing')||'[]');
        if(arr.length===0){ list.innerHTML='<div class="muted">Объявлений пока нет — вы можете добавить первое.</div>'; return }
        arr.forEach(h=>{
          const d=document.createElement('div');d.className='listing';d.innerHTML=`<div style="font-weight:700">${h.type} — ${h.city}</div><div class="muted">Цена: ${h.price||'по договорённости'}</div><div style="margin-top:6px">${h.contact||''}</div>`;
          list.appendChild(d);
        });
      }
    }
    async function addHousing(){
      const raw = { type:document.getElementById('h-type').value, city:document.getElementById('h-city').value, price:document.getElementById('h-price').value, contact:document.getElementById('h-contact').value };
      const h = Object.fromEntries(Object.entries(raw).map(([k,v])=>[k, (window.DOMPurify ? DOMPurify.sanitize(String(v)) : String(v))]));
      h.time = new Date().toISOString();
      const res = await postOrQueue('housing', h);
      // also keep a local copy for immediate UX
      const arr = JSON.parse(localStorage.getItem('dokwork_housing')||'[]'); arr.unshift(h); localStorage.setItem('dokwork_housing', JSON.stringify(arr));
      await loadHousing();
    }

    async function editHousing(h){
      const type = prompt('Тип', h.type); if(type===null) return; const city = prompt('Город', h.city); if(city===null) return; const price = prompt('Цена', h.price||'');
      const body = { type, city, price };
      const res = await authFetch(`${API}/housing/${h.id}`, { method:'PUT', body: JSON.stringify(body)});
      if(res.ok) alert('Объявление обновлено'); else alert('Ошибка при обновлении');
      await loadHousing();
    }

    async function deleteHousing(id){ if(!confirm('Удалить объявление?')) return; const res = await authFetch(`${API}/housing/${id}`, { method:'DELETE' }); if(res.ok) alert('Удалено'); else alert('Ошибка'); await loadHousing(); }

    // Jobs
    const jobsState = { page:1, limit:6, q:'' };
    async function loadJobs(){
      const list=document.getElementById('jobs-list');list.innerHTML='';
      try{
        const params = new URLSearchParams({ page: jobsState.page, limit: jobsState.limit, q: jobsState.q });
        const res = await authFetch(`${API}/jobs?${params.toString()}`);
        if(!res.ok) throw new Error('Bad response');
        const payload = await res.json();
        const arr = payload.items || [];
        if(arr.length===0){ list.innerHTML='<div class="muted">Вакансий пока нет — опубликуйте первую.</div>'; renderJobsPager(payload.meta); return }
        arr.forEach(j=>{
          const d=document.createElement('div');d.className='listing';d.innerHTML=`<div style="font-weight:700">${j.title}</div><div class="muted">Город: ${j.city} · Зарплата: ${j.salary||'по договорённости'}</div><div style="margin-top:6px">${j.contact||''}</div>`;
          const token = getToken(); if(token){ const btns=document.createElement('div'); btns.style.marginTop='8px'; const edit=document.createElement('button'); edit.className='btn btn-outline'; edit.textContent='Редактировать'; edit.onclick=()=>editJob(j); btns.appendChild(edit); const del=document.createElement('button'); del.className='btn btn-outline'; del.style.marginLeft='8px'; del.textContent='Удалить'; del.onclick=()=>deleteJob(j.id); btns.appendChild(del); d.appendChild(btns);} 
          list.appendChild(d);
        });
        renderJobsPager(payload.meta);
      }catch(e){
        const arr=JSON.parse(localStorage.getItem('dokwork_jobs')||'[]');
        if(arr.length===0){list.innerHTML='<div class="muted">Вакансий пока нет — опубликуйте первую.</div>';return}
        arr.forEach(j=>{ const d=document.createElement('div');d.className='listing';d.innerHTML=`<div style="font-weight:700">${j.title}</div><div class="muted">Город: ${j.city} · Зарплата: ${j.salary||'по договорённости'}</div><div style="margin-top:6px">${j.contact||''}</div>`; list.appendChild(d); });
      }
    }

    function renderJobsPager(meta){ const el=document.getElementById('jobs-pager'); el.innerHTML=''; if(!meta) return; const prev=document.createElement('button'); prev.className='btn btn-outline'; prev.textContent='◀'; prev.disabled = meta.page<=1; prev.onclick=()=>{ jobsState.page=Math.max(1,jobsState.page-1); loadJobs(); }; const next=document.createElement('button'); next.className='btn btn-outline'; next.textContent='▶'; next.disabled = meta.page>=meta.totalPages; next.onclick=()=>{ jobsState.page=Math.min(meta.totalPages,jobsState.page+1); loadJobs(); }; const info=document.createElement('div'); info.className='muted'; info.textContent=`Страница ${meta.page} из ${meta.totalPages} · Всего: ${meta.total}`; el.appendChild(prev); el.appendChild(info); el.appendChild(next); }

    async function editJob(j){
      const title = prompt('Должность', j.title); if(title===null) return; const city = prompt('Город', j.city); if(city===null) return; const salary = prompt('Зарплата', j.salary||'');
      const body = { title, city, salary };
      const res = await authFetch(`${API}/jobs/${j.id}`, { method:'PUT', body: JSON.stringify(body) });
      if(res.ok) alert('Вакансия обновлена'); else alert('Ошибка'); await loadJobs();
    }

    async function deleteJob(id){ if(!confirm('Удалить вакансию?')) return; const res = await authFetch(`${API}/jobs/${id}`, { method:'DELETE' }); if(res.ok) alert('Удалено'); else alert('Ошибка'); await loadJobs(); }
    async function addJob(){
      const raw = { title:document.getElementById('j-title').value, city:document.getElementById('j-city').value, salary:document.getElementById('j-salary').value, contact:document.getElementById('j-contact').value };
      const j = Object.fromEntries(Object.entries(raw).map(([k,v])=>[k, (window.DOMPurify ? DOMPurify.sanitize(String(v)) : String(v))]));
      j.time = new Date().toISOString();
      const res = await postOrQueue('jobs', j);
      const arr = JSON.parse(localStorage.getItem('dokwork_jobs')||'[]'); arr.unshift(j); localStorage.setItem('dokwork_jobs', JSON.stringify(arr));
      await loadJobs();
    }

    // Init
    // Auth helpers
    function getToken(){ return localStorage.getItem('dokwork_token'); }
    function setToken(t){ if(t) localStorage.setItem('dokwork_token', t); else localStorage.removeItem('dokwork_token'); }

    async function authFetch(url, opts={}){
      opts.headers = opts.headers || {};
      opts.headers['Content-Type'] = opts.headers['Content-Type'] || 'application/json';
      const token = getToken(); if(token) opts.headers['Authorization'] = 'Bearer '+token;
      return fetch(url, opts);
    }

    async function register(){
      const body = { name: document.getElementById('r-name').value, email: document.getElementById('r-email').value, password: document.getElementById('r-password').value };
      const res = await fetch(`${API}/auth/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
      if(res.ok){ alert('Регистрация успешна. Войдите в систему.'); document.getElementById('r-email').value=''; document.getElementById('r-password').value=''; }
      else { const e = await res.json(); alert('Ошибка регистрации: '+(e.message||JSON.stringify(e))); }
    }

    async function login(){
      const body = { email: document.getElementById('a-email').value, password: document.getElementById('a-password').value };
      const res = await fetch(`${API}/auth/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
      if(res.ok){ const data = await res.json(); setToken(data.token); showAccount(data.user); alert('Вход выполнен'); }
      else { const e = await res.json(); alert('Ошибка входа: '+(e.message||JSON.stringify(e))); }
    }

    function logout(){ setToken(null); hideAccount(); }

    function showAccount(user){ document.getElementById('auth-forms').style.display='none'; document.getElementById('account-info').style.display='block'; document.getElementById('acc-welcome').textContent = user.name || user.email; if(user.role==='admin'){ document.getElementById('admin-panel').style.display='block'; loadAdminProfiles(); } }
    function hideAccount(){ document.getElementById('auth-forms').style.display='block'; document.getElementById('account-info').style.display='none'; document.getElementById('admin-panel').style.display='none'; }

    async function loadAdminProfiles(){
      try{
        const res = await authFetch(`${API}/profiles`);
        if(!res.ok) throw new Error('Forbidden');
        const arr = await res.json();
        const el = document.getElementById('admin-profiles'); el.innerHTML='';
        arr.forEach(u=>{
          const d=document.createElement('div'); d.className='listing';
          d.innerHTML = `<div style="font-weight:700">${u.name||u.email}</div><div class="muted">${u.email} · ${u.role}</div>`;
          // actions: change role / delete
          const actions = document.createElement('div'); actions.style.marginTop='8px';
          const roleBtn = document.createElement('button'); roleBtn.className='btn btn-outline'; roleBtn.textContent='Изменить роль';
          roleBtn.onclick = ()=>adminEditProfile(u.id, u.role, u.name);
          const delBtn = document.createElement('button'); delBtn.className='btn btn-outline'; delBtn.style.marginLeft='8px'; delBtn.textContent='Удалить';
          delBtn.onclick = async ()=>{ if(!confirm('Удалить пользователя?')) return; const r = await authFetch(`${API}/profiles/${u.id}`, { method:'DELETE' }); if(r.ok) loadAdminProfiles(); else alert('Ошибка при удалении'); };
          actions.appendChild(roleBtn); actions.appendChild(delBtn);
          d.appendChild(actions);
          el.appendChild(d);
        });
      }catch(e){ console.error(e); }
    }

    async function adminEditProfile(id, currentRole, currentName){
      const role = prompt('Новая роль (user/admin)', currentRole||'user'); if(role===null) return;
      const name = prompt('Имя (оставьте пустым чтобы не менять)', currentName||'');
      const body = {};
      if(role) body.role = role;
      if(name) body.name = name;
      try{
        const res = await authFetch(`${API}/profiles/${id}`, { method:'PUT', body: JSON.stringify(body) });
        if(res.ok){ alert('Профиль обновлён'); loadAdminProfiles(); } else { const e = await res.json(); alert('Ошибка: '+(e.message||JSON.stringify(e))); }
      }catch(e){ alert('Ошибка: '+e.message); }
    }

    async function loadAdminListings(){
      try{
        const rh = await authFetch(`${API}/housing?limit=50&page=1`);
        const rj = await authFetch(`${API}/jobs?limit=50&page=1`);
        const hh = rh.ok ? (await rh.json()).items : [];
        const jj = rj.ok ? (await rj.json()).items : [];
        const elh = document.getElementById('admin-housing'); elh.innerHTML=''; hh.forEach(h=>{ const d=document.createElement('div'); d.className='listing'; d.innerHTML=`<div style="font-weight:700">${h.type} — ${h.city}</div><div class="muted">${h.price||''} · ${h.contact||''}</div><div style="margin-top:8px"><button class="btn btn-outline" onclick="adminDelete('housing',${h.id})">Удалить</button></div>`; elh.appendChild(d); });
        const elj = document.getElementById('admin-jobs'); elj.innerHTML=''; jj.forEach(j=>{ const d=document.createElement('div'); d.className='listing'; d.innerHTML=`<div style="font-weight:700">${j.title}</div><div class="muted">${j.city} · ${j.salary||''}</div><div style="margin-top:8px"><button class="btn btn-outline" onclick="adminDelete('jobs',${j.id})">Удалить</button></div>`; elj.appendChild(d); });
      }catch(e){ console.error(e); }
    }

    async function adminDelete(type,id){ if(!confirm('Удалить?')) return; const res = await authFetch(`${API}/${type}/${id}`, { method:'DELETE' }); if(res.ok){ alert('Удалено'); loadAdminListings(); } else { alert('Ошибка'); } }

    // On load
    document.addEventListener('DOMContentLoaded', async ()=>{ await flushQueues(); loadHousing(); loadJobs(); const token = getToken(); if(token){ try{ const r = await authFetch(`${API}/auth/me`); if(r.ok){ const user = await r.json(); showAccount(user); }else{ setToken(null); } }catch(e){ console.error(e); } } });

    // Client-side filtering helpers
    function filterHousingClient(){
      const q = document.getElementById('h-search').value.trim().toLowerCase();
      if(!q){ loadHousing(); return }
      // try local copy first
      const arr = JSON.parse(localStorage.getItem('dokwork_housing')||'[]');
      const filtered = arr.filter(h=>`${h.city} ${h.type} ${h.price||''}`.toLowerCase().includes(q));
      renderHousingList(filtered);
    }

    function filterJobsClient(){
      const q = document.getElementById('j-search').value.trim().toLowerCase();
      if(!q){ loadJobs(); return }
      const arr = JSON.parse(localStorage.getItem('dokwork_jobs')||'[]');
      const filtered = arr.filter(j=>`${j.title} ${j.city} ${j.salary||''}`.toLowerCase().includes(q));
      renderJobsList(filtered);
    }

    function renderHousingList(arr){ const list=document.getElementById('housing-list'); list.innerHTML=''; if(!arr||arr.length===0){ list.innerHTML='<div class="muted">Результатов нет.</div>'; return } arr.forEach(h=>{ const d=document.createElement('div');d.className='listing'; d.innerHTML=`<div style="font-weight:700">${h.type} — ${h.city}</div><div class="muted">Цена: ${h.price||'по договорённости'}</div><div style="margin-top:6px">${h.contact||''}</div>`; list.appendChild(d); }); }

    function renderJobsList(arr){ const list=document.getElementById('jobs-list'); list.innerHTML=''; if(!arr||arr.length===0){ list.innerHTML='<div class="muted">Результатов нет.</div>'; return } arr.forEach(j=>{ const d=document.createElement('div');d.className='listing'; d.innerHTML=`<div style="font-weight:700">${j.title}</div><div class="muted">Город: ${j.city} · Зарплата: ${j.salary||'по договорённости'}</div><div style="margin-top:6px">${j.contact||''}</div>`; list.appendChild(d); }); }
  </script>
</body>
</html>
